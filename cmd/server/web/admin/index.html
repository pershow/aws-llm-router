<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <base href="/backendSalsSavvyLLMRouter/" />
    <title>AWS Cursor Router Admin</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="bg-orb orb-a"></div>
    <div class="bg-orb orb-b"></div>
    <div class="bg-grid"></div>

    <main id="loginScreen" class="login-shell">
      <section class="login-card">
        <p class="eyebrow">AWS Cursor Router</p>
        <h1>Admin Login</h1>
        <p class="muted">输入后台令牌后进入管理台。</p>
        <div class="login-row">
          <input id="loginToken" type="password" placeholder="salessavvy token" autocomplete="current-password" />
          <button id="btnLogin" type="button">Login</button>
        </div>
        <p id="loginStatus" class="muted"></p>
      </section>
    </main>

    <main id="appShell" class="app-shell hidden">
      <header class="topbar card">
        <div>
          <p class="eyebrow">Control Panel</p>
          <h1>AWS Cursor Router Admin</h1>
          <p class="muted">管理模型开放、API Key、用量、成本与调用日志。</p>
        </div>
        <div class="topbar-actions">
          <button id="btnReload" class="secondary" type="button">Reload</button>
          <button id="btnLogout" class="ghost" type="button">Logout</button>
        </div>
      </header>

      <div class="dashboard-layout">
        <aside class="card side-menu">
          <p class="eyebrow">Menu</p>
          <nav id="menuList" class="menu-list">
            <button type="button" class="menu-item active" data-target="section-overview">总览</button>
            <button type="button" class="menu-item" data-target="section-security">安全</button>
            <button type="button" class="menu-item" data-target="section-aws">AWS 配置</button>
            <button type="button" class="menu-item" data-target="section-models">模型开放</button>
            <button type="button" class="menu-item" data-target="section-pricing">模型定价</button>
            <button type="button" class="menu-item" data-target="section-billing">全局额度</button>
            <button type="button" class="menu-item" data-target="section-clients">API Key</button>
            <button type="button" class="menu-item" data-target="section-usage">用量统计</button>
            <button type="button" class="menu-item" data-target="section-calls">调用记录</button>
            <button type="button" class="menu-item" data-target="section-logs">Debug Logs</button>
          </nav>
        </aside>

        <div class="main-content">
      <section id="section-overview" class="card section-card">
        <p id="statusText" class="muted"></p>
      </section>

      <section id="section-security" class="card section-card">
        <h2>Salessavvy Security</h2>
        <p class="muted">默认后台口令是 <code>admin123</code>。建议登录后立刻修改并妥善保存。</p>
        <div class="row">
          <input id="adminTokenInput" type="password" placeholder="new salessavvy token" autocomplete="new-password" />
          <button id="btnSaveAdminToken" type="button">Update Salessavvy Token</button>
        </div>
        <p id="adminTokenStatus" class="muted"></p>
      </section>

      <section id="section-aws" class="card section-card">
        <h2>AWS Bedrock Config</h2>
        <form id="awsForm" class="grid">
          <input id="awsRegion" placeholder="region (example: us-east-1)" required />
          <input id="awsAccessKeyId" placeholder="access key id (optional if IAM role)" />
          <input id="awsSecretAccessKey" type="password" placeholder="secret access key (optional if IAM role)" />
          <input id="awsSessionToken" placeholder="session token (optional)" />
          <input id="awsDefaultModelId" placeholder="default model id (optional)" />
          <button type="submit">Save AWS Config</button>
        </form>
        <p id="awsStatus" class="muted"></p>
      </section>

      <section id="section-models" class="card section-card">
        <h2>Available Models</h2>
        <p class="muted">模型来自 AWS Bedrock，可批量勾选代理开放模型。</p>
        <div class="row">
          <button id="btnRefreshModels" class="secondary" type="button">Refresh From AWS</button>
          <button id="btnSaveModels" type="button">Save Enabled Models</button>
          <button id="btnModelsSelectAll" class="ghost" type="button">Select All</button>
          <button id="btnModelsClear" class="ghost" type="button">Clear</button>
          <button id="btnModelsInvert" class="ghost" type="button">Invert</button>
        </div>
        <p id="modelsStatus" class="muted"></p>
        <div id="modelsList" class="models-list"></div>
      </section>

      <section id="section-pricing" class="card section-card">
        <h2>Model Pricing</h2>
        <p class="muted">只显示已启用模型。设置 USD / 1000 tokens，用于成本统计。</p>
        <div class="row">
          <button id="btnSavePricing" type="button">Save Pricing</button>
        </div>
        <p id="pricingStatus" class="muted"></p>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Model</th>
                <th>Input Price / 1000</th>
                <th>Output Price / 1000</th>
              </tr>
            </thead>
            <tbody id="pricingTableBody"></tbody>
          </table>
        </div>
      </section>

      <section id="section-billing" class="card section-card">
        <h2>Global Cost Guard</h2>
        <p class="muted">设置全局累计金额上限。<code>0</code> 表示不限制；超过上限后，所有客户端请求将被拒绝。</p>
        <div class="row">
          <input id="globalCostLimit" type="number" min="0" step="0.000001" placeholder="global cost limit (USD)" />
          <button id="btnSaveBilling" type="button">Save Global Limit</button>
        </div>
        <p class="muted">
          Current total cost:
          <strong id="currentTotalCost">$0.000000</strong>
        </p>
        <p id="billingStatus" class="muted"></p>
      </section>

      <section id="section-clients" class="card section-card">
        <h2>Client API Keys</h2>
        <form id="clientForm" class="grid">
          <input id="clientId" placeholder="id (example: team-a)" required />
          <input id="clientName" placeholder="name" required />
          <div class="field-with-action">
            <input id="clientKey" placeholder="api_key" required />
            <button id="btnGenerateApiKey" class="secondary" type="button">Generate</button>
          </div>
          <input id="clientRPM" type="number" min="1" placeholder="max rpm (1200)" />
          <input id="clientConcurrent" type="number" min="1" placeholder="max concurrent (64)" />
          <input id="clientModels" placeholder="allowed model IDs, comma separated" />
          <label class="checkbox-row">
            <input id="clientDisabled" type="checkbox" />
            Disable this API key
          </label>
          <button type="submit">Save Client</button>
        </form>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>API Key</th>
                <th>Limits</th>
                <th>Allowed Models</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="clientTableBody"></tbody>
          </table>
        </div>
      </section>

      <section id="section-usage" class="card section-card">
        <h2>Usage</h2>
        <div class="row">
          <input id="usageFrom" type="date" />
          <input id="usageTo" type="date" />
          <input id="usageClientId" placeholder="client id (optional)" />
          <button id="btnUsage" type="button">Load Usage</button>
        </div>

        <h3>By Client</h3>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Client</th>
                <th>Input</th>
                <th>Output</th>
                <th>Total</th>
                <th>Requests</th>
                <th>Cost (USD)</th>
              </tr>
            </thead>
            <tbody id="usageClientBody"></tbody>
          </table>
        </div>

        <h3>By Client + Model</h3>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Client</th>
                <th>Model</th>
                <th>Input</th>
                <th>Output</th>
                <th>Total</th>
                <th>Requests</th>
                <th>Cost (USD)</th>
              </tr>
            </thead>
            <tbody id="usageModelBody"></tbody>
          </table>
        </div>
      </section>

      <section id="section-calls" class="card section-card">
        <h2>Recent Calls</h2>
        <div class="row">
          <input id="callsLimit" type="number" min="1" max="500" value="100" placeholder="page size" />
          <input id="callsPage" type="number" min="1" value="1" placeholder="page" />
          <input id="callsClientId" placeholder="client id (optional)" />
          <button id="btnCallsPrev" class="ghost" type="button">Prev</button>
          <button id="btnCallsNext" class="ghost" type="button">Next</button>
          <button id="btnCalls" type="button">Load Calls</button>
        </div>
        <p id="callsPageInfo" class="muted"></p>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Time</th>
                <th>Client</th>
                <th>Model</th>
                <th>Input</th>
                <th>Output</th>
                <th>Tokens</th>
                <th>Cost (USD)</th>
                <th>Status</th>
                <th>Error</th>
                <th>Prompt</th>
                <th>Response</th>
              </tr>
            </thead>
            <tbody id="callsBody"></tbody>
          </table>
        </div>
      </section>
      <section id="section-logs" class="card section-card">
        <h2>Debug Logs</h2>
        <p class="muted">Download debug files generated by this router.</p>
        <div class="row">
          <input id="logsLimit" type="number" min="1" max="1000" value="100" placeholder="limit" />
          <button id="btnLogs" type="button">Load Logs</button>
        </div>
        <p id="logsStatus" class="muted"></p>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>File</th>
                <th>Size</th>
                <th>Modified (UTC)</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="logsBody"></tbody>
          </table>
        </div>
      </section>
        </div>
      </div>
    </main>

    <div id="contentModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="contentModalTitle">
      <div class="modal-card">
        <div class="modal-head">
          <h3 id="contentModalTitle">Content</h3>
          <button id="btnCloseContentModal" class="ghost" type="button">Close</button>
        </div>
        <div id="contentModalBody" class="modal-body log-rich"></div>
      </div>
    </div>

    <script src="app.js"></script>
  </body>
</html>

